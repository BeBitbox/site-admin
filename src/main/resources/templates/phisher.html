<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="nl">
<head>
  <title>Hello</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link th:href="@{/main.css}" rel="stylesheet"/>
</head>
<body>
<div class="container mx-auto p-4">
  <a class='my-8 float-right px-5 py-2 bg-red-500 text-white text-sm font-bold tracking-wide rounded-full focus:outline-none' href="/logout">Logout</a>
  <div class="grid grid-cols-1 gap-x-8 gap-y-6">
    <div class="">
      <div class="mb-6">
        <form id="emailForm" onsubmit="submitEmail(event)">
          <label for="email" class="block text-sm font-medium text-gray-700">E-mailadres:</label>
          <input
              type="email"
              id="email"
              name="email"
              required
              class="mt-1 block px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-300 focus:border-green-500"
              placeholder="Vul e-mailadressen in (; gescheiden)"
          />
          <br/>
          <button
              type="submit"
              class="mt-4 px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300"
           >
            Verzenden
          </button>
          <br/>
          <p id="feedbackOK" class="accent-green-950 hidden">Succes</p>
          <p id="feedbackNOK" class="accent-red-900 hidden">Niet OK</p>
        </form>
      </div>
      <script>
        function submitEmail(event) {
          event.preventDefault();
          const email = document.getElementById("email").value;
          const feedbackOK = document.getElementById("feedbackOK");
          const feedbackNOK = document.getElementById("feedbackNOK");
          feedbackOK.style.display = "none";
          feedbackNOK.style.display = "none";
          fetch('/vlaanderen.click/add', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({id: email})
          })
          .then(response => {
            if (response.ok) {
              feedbackOK.style.display = "inline";
            } else {
              feedbackNOK.style.display = "inline";
            }
          })
          .catch(() => {
            alert('Netwerkfout bij het verzenden van het e-mailadres.');
          });
        }
      </script>
    </div>

    <div class="mt-6">
      <button
          type="button"
          class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300"
          onclick="downloadFile(true)"
      >
        Download User Data
      </button>
      <button
          type="button"
          class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300"
          onclick="downloadFile(false)"
      >
        Download QR Data
      </button>
      <script>
        function downloadFile(isUser) {
          const input = isUser ? '/downloadUserClickData' : '/downloadQrData';
          const downloadedFileName = isUser ? 'user_click_data.csv' : 'qr_data.csv';
          fetch(input, {
            method: 'GET'
          })
          .then(response => {
            if (response.ok) {
              return response.blob();
            } else {
              alert('Kon de data niet downloaden.');
              throw new Error('Failed to download file');
            }
          })
          .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = downloadedFileName;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
          })
          .catch(() => {
            alert('Er is een fout opgetreden bij het downloaden van de data.');
          });
        }
      </script>
    </div>
</div>
</div>
</body>
</html>
